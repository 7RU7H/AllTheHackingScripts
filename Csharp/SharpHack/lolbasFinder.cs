findlolbas.cs
// Script for finding all LOLBAS files on an entire Windows Host
// https://lolbas-project.github.io/#
// Aided by the poor Github Copilot suffering my terrible coding
// Makes programming even more fun!

using System;
using System.IO;
using System.Collections.Generic;
using System.Linq;

namespace SharpHack.findlolbas
{
    public class Findlolbas
    {
        static void Main()
        {
            List<string> lolbasList = List<string>("C:\ProgramData\Microsoft\WindowsDefender\Platform\4.18.2008.4-0\MpCmdRun.exe","C:\ProgramData\Microsoft\WindowsDefender\Platform\4.18.2008.7-0\MpCmdRun.exe","C:\ProgramData\Microsoft\WindowsDefender\Platform\4.18.2008.9-0\ConfigSecurityPolicy.exe","C:\ProgramData\Microsoft\WindowsDefender\Platform\4.18.2008.9-0\MpCmdRun.exe","C:\ProgramFiles\dotnet\dotnet.exe","C:\ProgramFiles\dotnet\sdk\[sdkversion]\FSharp\fsi.exe","C:\ProgramFiles\InternetExplorer\Extexport.exe","C:\ProgramFiles\MicrosoftOffice14\ClientX64\Root\Office14\Excel.exe","C:\ProgramFiles\MicrosoftOffice14\ClientX64\Root\Office14\Powerpnt.exe","C:\ProgramFiles\MicrosoftOffice14\ClientX64\Root\Office14\winword.exe","C:\ProgramFiles\MicrosoftOffice15\ClientX64\Root\Office15\Excel.exe","C:\ProgramFiles\MicrosoftOffice15\ClientX64\Root\Office15\Powerpnt.exe","C:\ProgramFiles\MicrosoftOffice15\ClientX64\Root\Office15\winword.exe","C:\ProgramFiles\MicrosoftOffice16\ClientX64\Root\Office16\Excel.exe","C:\ProgramFiles\MicrosoftOffice16\ClientX64\Root\Office16\Powerpnt.exe","C:\ProgramFiles\MicrosoftOffice16\ClientX64\Root\Office16\winword.exe","C:\ProgramFiles\MicrosoftOffice\Office12\Excel.exe","C:\ProgramFiles\MicrosoftOffice\Office12\Powerpnt.exe","C:\ProgramFiles\MicrosoftOffice\Office12\winword.exe","C:\ProgramFiles\MicrosoftOffice\Office14\Excel.exe","C:\ProgramFiles\MicrosoftOffice\Office14\Powerpnt.exe","C:\ProgramFiles\MicrosoftOffice\Office14\winword.exe","C:\ProgramFiles\MicrosoftOffice\Office15\Excel.exe","C:\ProgramFiles\MicrosoftOffice\Office15\Powerpnt.exe","C:\ProgramFiles\MicrosoftOffice\Office15\winword.exe","C:\ProgramFiles\MicrosoftOffice\Office16\Excel.exe","C:\ProgramFiles\MicrosoftOffice\Office16\Powerpnt.exe","C:\ProgramFiles\MicrosoftOffice\Office16\winword.exe","C:\ProgramFiles\MicrosoftOffice\root\client\appvlp.exe","C:\ProgramFiles\MicrosoftOffice\root\Office16\winword.exe","C:\ProgramFiles\MicrosoftSilverlight\5.1.50918.0\coregen.exe","C:\ProgramFiles\MicrosoftSQLServer\90\Shared\SQLDumper.exe","C:\ProgramFiles\WindowsApps\Microsoft.DesktopAppInstaller_1.11.2521.0_x64__8wekyb3d8bbwe\AppInstaller.exe","C:\ProgramFiles\WindowsDefender\Offline\OfflineScannerShell.exe","C:\ProgramFiles\WindowsMail\wab.exe","c:\ProgramFiles\WindowsPowerShell\Modules\Pester\3.4.0\bin\Pester.bat","c:\ProgramFiles\WindowsPowerShell\Modules\Pester\*\bin\Pester.bat","C:\ProgramFiles(x86)\IIS\MicrosoftWebDeployV3\msdeploy.exe","C:\ProgramFiles(x86)\InternetExplorer\Extexport.exe","C:\ProgramFiles(x86)\Microsoft\DefaultPack\","C:\ProgramFiles(x86)\MicrosoftIntuneManagementExtension","C:\ProgramFiles(x86)\MicrosoftOffice14\ClientX86\Root\Office14\Excel.exe","C:\ProgramFiles(x86)\MicrosoftOffice14\ClientX86\Root\Office14\Powerpnt.exe","C:\ProgramFiles(x86)\MicrosoftOffice14\ClientX86\Root\Office14\winword.exe","C:\ProgramFiles(x86)\MicrosoftOffice15\ClientX86\Root\Office15\Excel.exe","C:\ProgramFiles(x86)\MicrosoftOffice15\ClientX86\Root\Office15\Powerpnt.exe","C:\ProgramFiles(x86)\MicrosoftOffice15\ClientX86\Root\Office15\winword.exe","C:\ProgramFiles(x86)\MicrosoftOffice16\ClientX86\Root\Office16\Excel.exe","C:\ProgramFiles(x86)\MicrosoftOffice16\ClientX86\Root\Office16\Powerpnt.exe","C:\ProgramFiles(x86)\MicrosoftOffice16\ClientX86\Root\Office16\winword.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office12\Excel.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office12\Powerpnt.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office12\winword.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office14\Excel.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office14\Powerpnt.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office14\winword.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office15\Excel.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office15\Powerpnt.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office15\winword.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office16\Excel.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office16\Powerpnt.exe","C:\ProgramFiles(x86)\MicrosoftOffice\Office16\winword.exe","C:\ProgramFiles(x86)\MicrosoftOffice\root\client\appvlp.exe","C:\ProgramFiles(x86)\MicrosoftOffice\root\vfs\ProgramFilesX86\MicrosoftAnalysis\ASOLEDB\140\SQLDumper.exe","C:\ProgramFiles(x86)\MicrosoftSDKs\Windows\v10.0A\bin\NETFX4.8Tools\wfc.exe","C:\ProgramFiles(x86)\MicrosoftSilverlight\5.1.50918.0\coregen.exe","C:\Programfiles(x86)\MicrosoftSQLServer\100\Tools\Binn\sqlps.exe","C:\Programfiles(x86)\MicrosoftSQLServer\110\Tools\Binn\sqlps.exe","C:\Programfiles(x86)\MicrosoftSQLServer\120\Tools\Binn\sqlps.exe","C:\Programfiles(x86)\MicrosoftSQLServer\130\Tools\Binn\sqlps.exe","C:\Programfiles(x86)\MicrosoftSQLServer\130\Tools\Binn\sqlps.exe","c:\ProgramFiles(x86)\MicrosoftVisualStudio\2017\Community\MSBuild\15.0\Bin\Roslyn\csi.exe","C:\ProgramFiles(x86)\MicrosoftVisualStudio\2019\Community\Common7\IDE\Extensions\Microsoft\WebTools\ProjectSystem\VSIISExeLauncher.exe","c:\ProgramFiles(x86)\MicrosoftVisualStudio\2019\Professional\Common7\IDE\CommonExtensions\Microsoft\FSharp\fsianycpu.exe","C:\ProgramFiles(x86)\MicrosoftVisualStudio\2019\Professional\Common7\IDE\CommonExtensions\Microsoft\FSharp\fsi.exe","c:\ProgramFiles(x86)\MicrosoftWebTools\Packages\Microsoft.Net.Compilers.X.Y.Z\tools\csi.exe","C:\ProgramFiles(x86)\MSBuild\14.0\bin\MSBuild.exe","C:\ProgramFiles(x86)\WindowsKits\10\bin\10.0.16299.0\x64","C:\ProgramFiles(x86)\WindowsKits\10\bin\10.0.16299.0\x86","c:\ProgramFiles(x86)\WindowsKits\10\bin\[SDKversion]\arm64\UIAVerify\VisualUiaVerifyNative.exe","c:\ProgramFiles(x86)\WindowsKits\10\bin\[SDKversion]\UIAVerify\VisualUiaVerifyNative.exe","c:\ProgramFiles(x86)\WindowsKits\10\bin\[SDKversion]\x64\UIAVerify\VisualUiaVerifyNative.exe","C:\ProgramFiles(x86)\WindowsKits\10\bin\x64","C:\ProgramFiles(x86)\WindowsKits\10\bin\x86","C:\ProgramFiles(x86)\WindowsKits\10\Debuggers\x64\adplus.exe","C:\ProgramFiles(x86)\WindowsKits\10\Debuggers\x64\cdb.exe","C:\ProgramFiles(x86)\WindowsKits\10\Debuggers\x64\remote.exe","C:\ProgramFiles(x86)\WindowsKits\10\Debuggers\x86\adplus.exe","C:\ProgramFiles(x86)\WindowsKits\10\Debuggers\x86\cdb.exe","C:\ProgramFiles(x86)\WindowsKits\10\Debuggers\x86\remote.exe","C:\ProgramFiles(x86)\WindowsMail\wab.exe","C:\Windows\diagnostics\system\AERO\CL_Invocation.ps1","C:\Windows\diagnostics\system\Audio\CL_Invocation.ps1","C:\Windows\diagnostics\system\Audio\CL_LoadAssembly.ps1","C:\Windows\diagnostics\system\Audio\CL_Mutexverifiers.ps1","C:\Windows\diagnostics\system\Networking\UtilityFunctions.ps1","C:\Windows\diagnostics\system\Speech\CL_Mutexverifiers.ps1","C:\Windows\diagnostics\system\Video\CL_Mutexverifiers.ps1","C:\Windows\diagnostics\system\WindowsUpdate\CL_Invocation.ps1","C:\Windows\diagnostics\system\WindowsUpdate\CL_Mutexverifiers.ps1","C:\Windows\diagnostics\system\WindowsUpdate\CL_Mutexverifiers.ps1","C:\Windows\explorer.exe","C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Dfsvc.exe","C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Dfsvc.exe","C:\Windows\Microsoft.NET\Framework64\v2.0.50727\ieexec.exe","C:\Windows\Microsoft.NET\Framework64\v2.0.50727\InstallUtil.exe","C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Jsc.exe","C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Msbuild.exe","C:\Windows\Microsoft.NET\Framework64\v2.0.50727\regasm.exe","C:\Windows\Microsoft.NET\Framework64\v3.5\DataSvcUtil.exe","C:\Windows\Microsoft.NET\Framework64\v3.5\Msbuild.exe","C:\Windows\Microsoft.NET\Framework64\v3.5\vbc.exe","c:\Windows\Microsoft.NET\Framework64\v4.0.30319\aspnet_compiler.exe","C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Csc.exe","C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Dfsvc.exe","C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Dfsvc.exe","C:\Windows\Microsoft.NET\Framework64\v4.0.30319\ilasm.exe","C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe","C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Jsc.exe","C:\Windows\Microsoft.Net\Framework64\v4.0.30319\Microsoft.Workflow.Compiler.exe","C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Msbuild.exe","C:\Windows\Microsoft.NET\Framework64\v4.0.30319\regasm.exe","C:\Windows\Microsoft.NET\Framework64\v4.0.30319\vbc.exe","C:\Windows\Microsoft.NET\Framework\v2.0.50727\Dfsvc.exe","C:\Windows\Microsoft.NET\Framework\v2.0.50727\Dfsvc.exe","C:\Windows\Microsoft.NET\Framework\v2.0.50727\ieexec.exe","C:\Windows\Microsoft.NET\Framework\v2.0.50727\InstallUtil.exe","C:\Windows\Microsoft.NET\Framework\v2.0.50727\Jsc.exe","C:\Windows\Microsoft.NET\Framework\v2.0.50727\Msbuild.exe","C:\Windows\Microsoft.NET\Framework\v2.0.50727\regasm.exe","C:\Windows\Microsoft.NET\Framework\v3.5\Msbuild.exe","c:\Windows\Microsoft.NET\Framework\v4.0.30319\aspnet_compiler.exe","C:\Windows\Microsoft.NET\Framework\v4.0.30319\Csc.exe","C:\Windows\Microsoft.NET\Framework\v4.0.30319\Dfsvc.exe","C:\Windows\Microsoft.NET\Framework\v4.0.30319\Dfsvc.exe","C:\Windows\Microsoft.NET\Framework\v4.0.30319\ilasm.exe","C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil.exe","C:\Windows\Microsoft.NET\Framework\v4.0.30319\Jsc.exe","C:\Windows\Microsoft.NET\Framework\v4.0.30319\Msbuild.exe","C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe","c:\windows\system32\advpack.dll","C:\Windows\System32\Atbroker.exe","C:\WINDOWS\System32\At.exe","C:\Windows\System32\bash.exe","C:\Windows\System32\bitsadmin.exe","c:\windows\system32\certoc.exe","C:\Windows\System32\certreq.exe","C:\Windows\System32\certutil.exe","C:\Windows\System32\cmd.exe","C:\Windows\System32\cmdkey.exe","C:\Windows\System32\cmdl32.exe","C:\Windows\System32\cmstp.exe","c:\windows\system32\comsvcs.dll","C:\Windows\System32\control.exe","C:\Windows\System32\cscript.exe","c:\windows\system32\desktopimgdownldr.exe","c:\windows\system32\devtoolslauncher.exe","c:\windows\system32\diantz.exe","C:\Windows\System32\diskshadow.exe","C:\Windows\System32\dllhost.exe","C:\Windows\System32\Dnscmd.exe","C:\Windows\System32\dxcap.exe","C:\Windows\System32\esentutl.exe","C:\Windows\System32\eventvwr.exe","C:\Windows\System32\Expand.exe","C:\Windows\System32\extrac32.exe","C:\Windows\System32\findstr.exe","c:\windows\system32\finger.exe","C:\Windows\System32\fltMC.exe","C:\Windows\System32\forfiles.exe","C:\Windows\System32\ftp.exe","C:\Windows\System32\gpscript.exe","C:\Windows\System32\hh.exe","c:\windows\system32\ie4uinit.exe","c:\windows\system32\ieadvpack.dll","c:\windows\system32\ieframe.dll","c:\windows\system32\ieuinit.inf","C:\Windows\System32\IME\SHARED\IMEWDBLD.exe","C:\Windows\System32\Infdefaultinstall.exe","C:\Windows\System32\makecab.exe","C:\Windows\System32\manage-bde.wsf","C:\Windows\System32\mavinject.exe","C:\Windows\System32\mmc.exe","C:\Windows\System32\msconfig.exe","C:\Windows\System32\Msdt.exe","C:\Windows\System32\mshta.exe","c:\windows\system32\mshtml.dll","C:\Windows\System32\msiexec.exe","C:\WINDOWS\System32\Netsh.exe","C:\Windows\System32\ntdsutil.exe","C:\Windows\System32\odbcconf.exe","C:\Windows\System32\pcalua.exe","C:\Windows\System32\pcwrun.exe","c:\windows\system32\pcwutl.dll","c:\windows\system32\pktmon.exe","C:\Windows\system32\pnputil.exe","C:\Windows\System32\Presentationhost.exe","C:\Windows\System32\print.exe","C:\Windows\System32\Printing_Admin_Scripts\en-US\pubprn.vbs","c:\windows\system32\psr.exe","C:\Windows\System32\rasautou.exe","C:\Windows\System32\regedit.exe","C:\Windows\System32\reg.exe","C:\Windows\System32\regini.exe","C:\Windows\System32\Register-cimprovider.exe","C:\Windows\System32\regsvcs.exe","C:\Windows\System32\regsvr32.exe","C:\Windows\System32\replace.exe","C:\Windows\System32\rpcping.exe","C:\Windows\System32\rundll32.exe","C:\Windows\System32\runonce.exe","C:\Windows\System32\sc.exe","c:\windows\system32\schtasks.exe","C:\Windows\System32\scriptrunner.exe","C:\Windows\System32\SettingSyncHost.exe","c:\windows\system32\setupapi.dll","c:\windows\system32\shdocvw.dll","c:\windows\system32\shell32.dll","C:\Windows\System32\spool\tools\PrintBrm.exe","c:\windows\system32\stordiag.exe","C:\Windows\System32\SyncAppvPublishingServer.exe","C:\Windows\System32\SyncAppvPublishingServer.vbs","c:\windows\system32\syssetup.dll","C:\Windows\System32\ttdinject.exe","C:\Windows\System32\tttracer.exe","c:\windows\system32\url.dll","C:\Windows\System32\verclsid.exe","c:\windows\system32\vsjitdebugger.exe","C:\Windows\System32\wbem\wmic.exe","C:\Windows\System32\winrm.vbs","c:\windows\system32\wlrmdr.exe","C:\Windows\System32\WorkFolders.exe","C:\Windows\System32\wscript.exe","C:\Windows\System32\wsl.exe","C:\Windows\System32\wsreset.exe","C:\Windows\System32\wuauclt.exe","C:\Windows\System32\xwizard.exe","c:\windows\system32\zipfldr.dll","c:\windows\syswow64\advpack.dll","C:\Windows\SysWOW64\Atbroker.exe","C:\WINDOWS\SysWOW64\At.exe","C:\Windows\SysWOW64\bash.exe","C:\Windows\SysWOW64\bitsadmin.exe","c:\windows\syswow64\certoc.exe","C:\Windows\SysWOW64\certreq.exe","C:\Windows\SysWOW64\certutil.exe","C:\Windows\SysWOW64\cmd.exe","C:\Windows\SysWOW64\cmdkey.exe","C:\Windows\SysWOW64\cmdl32.exe","C:\Windows\SysWOW64\cmstp.exe","C:\Windows\SysWOW64\control.exe","C:\Windows\SysWOW64\cscript.exe","c:\windows\syswow64\diantz.exe","C:\Windows\SysWOW64\diskshadow.exe","C:\Windows\SysWOW64\dllhost.exe","C:\Windows\SysWOW64\Dnscmd.exe","C:\Windows\SysWOW64\dxcap.exe","C:\Windows\SysWOW64\esentutl.exe","C:\Windows\SysWOW64\eventvwr.exe","C:\Windows\SysWOW64\Expand.exe","C:\Windows\SysWOW64\explorer.exe","C:\Windows\SysWOW64\extrac32.exe","C:\Windows\SysWOW64\findstr.exe","c:\windows\syswow64\finger.exe","C:\Windows\SysWOW64\forfiles.exe","C:\Windows\SysWOW64\ftp.exe","C:\Windows\SysWOW64\gpscript.exe","C:\Windows\SysWOW64\hh.exe","c:\windows\sysWOW64\ie4uinit.exe","c:\windows\syswow64\ieadvpack.dll","c:\windows\syswow64\ieframe.dll","c:\windows\sysWOW64\ieuinit.inf","C:\Windows\SysWOW64\Infdefaultinstall.exe","C:\Windows\SysWOW64\makecab.exe","C:\Windows\SysWOW64\mavinject.exe","C:\Windows\SysWOW64\mmc.exe","C:\Windows\SysWOW64\Msdt.exe","C:\Windows\SysWOW64\mshta.exe","c:\windows\syswow64\mshtml.dll","C:\Windows\SysWOW64\msiexec.exe","C:\WINDOWS\SysWOW64\Netsh.exe","C:\Windows\SysWOW64\odbcconf.exe","c:\windows\syswow64\pcwutl.dll","c:\windows\syswow64\pktmon.exe","C:\Windows\SysWOW64\Presentationhost.exe","C:\Windows\SysWOW64\print.exe","C:\Windows\SysWOW64\Printing_Admin_Scripts\en-US\pubprn.vbs","c:\windows\syswow64\psr.exe","C:\Windows\SysWOW64\regedit.exe","C:\Windows\SysWOW64\reg.exe","C:\Windows\SysWOW64\regini.exe","C:\Windows\SysWOW64\Register-cimprovider.exe","C:\Windows\SysWOW64\regsvcs.exe","C:\Windows\SysWOW64\regsvr32.exe","C:\Windows\SysWOW64\replace.exe","C:\Windows\SysWOW64\rpcping.exe","C:\Windows\SysWOW64\rundll32.exe","C:\Windows\SysWOW64\runonce.exe","C:\Windows\SysWOW64\sc.exe","c:\windows\syswow64\schtasks.exe","C:\Windows\SysWOW64\scriptrunner.exe","C:\Windows\SysWOW64\SettingSyncHost.exe","c:\windows\syswow64\setupapi.dll","c:\windows\syswow64\shdocvw.dll","c:\windows\syswow64\shell32.dll","c:\windows\syswow64\stordiag.exe","C:\Windows\SysWOW64\SyncAppvPublishingServer.exe","c:\windows\syswow64\syssetup.dll","C:\Windows\Syswow64\ttdinject.exe","C:\Windows\SysWOW64\tttracer.exe","c:\windows\syswow64\url.dll","C:\Windows\SysWOW64\verclsid.exe","C:\Windows\SysWOW64\wbem\wmic.exe","C:\Windows\SysWOW64\winrm.vbs","C:\Windows\SysWOW64\wscript.exe","C:\Windows\SysWOW64\xwizard.exe","c:\windows\syswow64\zipfldr.dll","C:\Windows\WinSxS\amd64_microsoft-windows-u..ed-telemetry-client_31bf3856ad364e35_10.0.16299.15_none_c2df1bba78111118\Runscripthelper.exe","C:\Windows\WinSxS\amd64_microsoft-windows-u..ed-telemetry-client_31bf3856ad364e35_10.0.16299.192_none_ad4699b571e00c4a\Runscripthelper.exe","%localappdata%\Microsoft\OneDrive\OneDriveStandaloneUpdater.exe","%localappdata%\Microsoft\Teams\current\Squirrel.exe","%localappdata%\Microsoft\Teams\update.exe")

            //Loop through list and use icalcs to check each filepath in lolbasList
            for (int i = 0; i < lolbasList.Count; i++)
            {
                //Check if filepath is a file
                if (File.Exists(lolbasList[i]))
                {
                    //Run icacls on lolbasList[i]
                    ProcessStartInfo startInfo = new ProcessStartInfo();
                    startInfo.FileName = "icacls";
                    startInfo.Arguments = lolbasList[i];
                    startInfo.WindowStyle = ProcessWindowStyle.Hidden;
                    startInfo.CreateNoWindow = true;
                    startInfo.UseShellExecute = false;
                    startInfo.RedirectStandardOutput = true;
                    startInfo.RedirectStandardError = true;
                    Process process = new Process();
                    process.StartInfo = startInfo;
                    process.Start();
                    process.WaitForExit();
                    string output = process.StandardOutput.ReadToEnd();
                    string error = process.StandardError.ReadToEnd();
                    if (output.Contains("Success"))
                    {
                        //If icacls ran successfully, add to successList
                        successList.Add(lolbasList[i]);
                    }
                    else
                    {
                        //If icacls failed, add to errorList
                        errorList.Add(lolbasList[i]);
                    }
                }
                else
                {
                    //If filepath is not a file, add to errorList
                    errorList.Add(lolbasList[i]);
                }
            }
                //Print all successList

                if (successList.Count > 0){
                    Console.WriteLine("Filepath " + lolbasList[i] + " is not a file");
                }
                //Exit program
                Environment.Exit(0);
           }



        }
    }
}
